<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #79bef0;
        }
        #vis {
            border: 1px solid #ddd;
            padding: 10px;
            background-color: rgb(161, 223, 248);
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Interactive COVID-19 Dashboard</h1>

<div style="display: flex; justify-content: center; margin-top: 20px;">
    <div id="vis"></div>
</div>

<script>
const spec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": ["Interactive COVID-19 Dashboard"],
    "anchor": "middle",
    "fontSize": 18,
    "color": "#1e3a8a"
  },
  "data": {
    "url": "https://catalog.ourworldindata.org/garden/covid/latest/compact/compact.csv",
    "format": {"type": "csv", "delimiter": ","}
  },
  "params": [
    // dropdown menu
    {
      "name": "selected_country",
      "bind": {
        "input": "select",
        "options": ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czechia", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Hungary", "Iceland", "India", "Indonesia","Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kuwait", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Mauritania", "Mauritius", "Mexico", "Mongolia", "Morocco", "Mozambique","Myanmar", "Namibia", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway", "Oman", "Pakistan", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Sierra Leone", "Slovakia", "Slovenia", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Syria", "Tanzania", "Thailand", "Togo", "Trinidad and Tobago", "Tunisia", "Turkey", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Vanuatu", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ],
        "name": "Select Country: "
      },
      "value": "United States",
      "on": [
        {"events": "map_plot:click", "update": "datum.country_name"}
      ]
    }
  ],
"datasets": { // matching each id
  "country_lookup": [
    {"id": "004", "name": "Afghanistan"},
    {"id": "008", "name": "Albania"},
    {"id": "012", "name": "Algeria"},
    {"id": "020", "name": "Andorra"},
    {"id": "024", "name": "Angola"},
    {"id": "028", "name": "Antigua and Barbuda"},
    {"id": "032", "name": "Argentina"},
    {"id": "051", "name": "Armenia"},
    {"id": "036", "name": "Australia"},
    {"id": "040", "name": "Austria"},
    {"id": "031", "name": "Azerbaijan"},
    {"id": "044", "name": "Bahamas"},
    {"id": "048", "name": "Bahrain"},
    {"id": "050", "name": "Bangladesh"},
    {"id": "052", "name": "Barbados"},
    {"id": 112, "name": "Belarus"},
    {"id": "056", "name": "Belgium"},
    {"id": "084", "name": "Belize"},
    {"id": "064", "name": "Bhutan"},
    {"id": "068", "name": "Bolivia"},
    {"id": "070", "name": "Bosnia and Herzegovina"},
    {"id": "072", "name": "Botswana"},
    {"id": "076", "name": "Brazil"},
    {"id": 100, "name": "Bulgaria"},
    {"id": 116, "name": "Cambodia"},
    {"id": 120, "name": "Cameroon"},
    {"id": 124, "name": "Canada"},
    {"id": 140, "name": "Central African Republic"},
    {"id": 148, "name": "Chad"},
    {"id": 152, "name": "Chile"},
    {"id": 156, "name": "China"},
    {"id": 170, "name": "Colombia"},
    {"id": 174, "name": "Comoros"},
    {"id": 178, "name": "Congo"},
    {"id": 188, "name": "Costa Rica"},
    {"id": 191, "name": "Croatia"},
    {"id": 192, "name": "Cuba"},
    {"id": 196, "name": "Cyprus"},
    {"id": 203, "name": "Czechia"},
    {"id": 208, "name": "Denmark"},
    {"id": 262, "name": "Djibouti"},
    {"id": 212, "name": "Dominica"},
    {"id": 214, "name": "Dominican Republic"},
    {"id": 626, "name": "East Timor"},
    {"id": 218, "name": "Ecuador"},
    {"id": 818, "name": "Egypt"},
    {"id": 222, "name": "El Salvador"},
    {"id": 226, "name": "Equatorial Guinea"},
    {"id": 233, "name": "Estonia"},
    {"id": 748, "name": "Eswatini"},
    {"id": 230, "name": "Ethiopia"},
    {"id": 242, "name": "Fiji"},
    {"id": 246, "name": "Finland"},
    {"id": 250, "name": "France"},
    {"id": 266, "name": "Gabon"},
    {"id": 270, "name": "Gambia"},
    {"id": 268, "name": "Georgia"},
    {"id": 276, "name": "Germany"},
    {"id": 288, "name": "Ghana"},
    {"id": 300, "name": "Greece"},
    {"id": 308, "name": "Grenada"},
    {"id": 320, "name": "Guatemala"},
    {"id": 324, "name": "Guinea"},
    {"id": 624, "name": "Guinea-Bissau"},
    {"id": 328, "name": "Guyana"},
    {"id": 332, "name": "Haiti"},
    {"id": 348, "name": "Hungary"},
    {"id": 352, "name": "Iceland"},
    {"id": 356, "name": "India"},
    {"id": 360, "name": "Indonesia"},
    {"id": 364, "name": "Iran"},
    {"id": 368, "name": "Iraq"},
    {"id": 372, "name": "Ireland"},
    {"id": 376, "name": "Israel"},
    {"id": 380, "name": "Italy"},
    {"id": 388, "name": "Jamaica"},
    {"id": 392, "name": "Japan"},
    {"id": 400, "name": "Jordan"},
    {"id": 398, "name": "Kazakhstan"},
    {"id": 404, "name": "Kenya"},
    {"id": 414, "name": "Kuwait"},
    {"id": 418, "name": "Laos"},
    {"id": 428, "name": "Latvia"},
    {"id": 422, "name": "Lebanon"},
    {"id": 426, "name": "Lesotho"},
    {"id": 430, "name": "Liberia"},
    {"id": 440, "name": "Lithuania"},
    {"id": 442, "name": "Luxembourg"},
    {"id": 450, "name": "Madagascar"},
    {"id": 454, "name": "Malawi"},
    {"id": 458, "name": "Malaysia"},
    {"id": 462, "name": "Maldives"},
    {"id": 466, "name": "Mali"},
    {"id": 470, "name": "Malta"},
    {"id": 478, "name": "Mauritania"},
    {"id": 480, "name": "Mauritius"},
    {"id": 484, "name": "Mexico"},
    {"id": 496, "name": "Mongolia"},
    {"id": 504, "name": "Morocco"},
    {"id": 508, "name": "Mozambique"},
    {"id": 104, "name": "Myanmar"},
    {"id": 516, "name": "Namibia"},
    {"id": 524, "name": "Nepal"},
    {"id": 528, "name": "Netherlands"},
    {"id": 554, "name": "New Zealand"},
    {"id": 558, "name": "Nicaragua"},
    {"id": 562, "name": "Niger"},
    {"id": 566, "name": "Nigeria"},
    {"id": 807, "name": "North Macedonia"},
    {"id": 578, "name": "Norway"},
    {"id": 512, "name": "Oman"},
    {"id": 586, "name": "Pakistan"},
    {"id": 591, "name": "Panama"},
    {"id": 598, "name": "Papua New Guinea"},
    {"id": 600, "name": "Paraguay"},
    {"id": 604, "name": "Peru"},
    {"id": 608, "name": "Philippines"},
    {"id": 616, "name": "Poland"},
    {"id": 620, "name": "Portugal"},
    {"id": 634, "name": "Qatar"},
    {"id": 642, "name": "Romania"},
    {"id": 643, "name": "Russia"},
    {"id": 646, "name": "Rwanda"},
    {"id": 659, "name": "Saint Kitts and Nevis"},
    {"id": 662, "name": "Saint Lucia"},
    {"id": 670, "name": "Saint Vincent and the Grenadines"},
    {"id": 678, "name": "Sao Tome and Principe"},
    {"id": 682, "name": "Saudi Arabia"},
    {"id": 686, "name": "Senegal"},
    {"id": 688, "name": "Serbia"},
    {"id": 694, "name": "Sierra Leone"},
    {"id": 703, "name": "Slovakia"},
    {"id": 705, "name": "Slovenia"},
    {"id": 706, "name": "Somalia"},
    {"id": 710, "name": "South Africa"},
    {"id": 410, "name": "South Korea"},
    {"id": 728, "name": "South Sudan"},
    {"id": 724, "name": "Spain"},
    {"id": 144, "name": "Sri Lanka"},
    {"id": 729, "name": "Sudan"},
    {"id": 740, "name": "Suriname"},
    {"id": 752, "name": "Sweden"},
    {"id": 760, "name": "Syria"},
    {"id": 834, "name": "Tanzania"},
    {"id": 764, "name": "Thailand"},
    {"id": 768, "name": "Togo"},
    {"id": 780, "name": "Trinidad and Tobago"},
    {"id": 788, "name": "Tunisia"},
    {"id": 792, "name": "Turkey"},
    {"id": 800, "name": "Uganda"},
    {"id": 804, "name": "Ukraine"},
    {"id": 784, "name": "United Arab Emirates"},
    {"id": 826, "name": "United Kingdom"},
    {"id": 840, "name": "United States"},
    {"id": 858, "name": "Uruguay"},
    {"id": 548, "name": "Vanuatu"},
    {"id": 704, "name": "Vietnam"},
    {"id": 887, "name": "Yemen"},
    {"id": 894, "name": "Zambia"},
    {"id": 716, "name": "Zimbabwe"}
  ]
},
  "vconcat": [
// row 1, this is just the map
    {
      "name": "map_plot", 
      "width": 750, 
      "height": 180,
      "data": {
        "url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
        "format": {
          "type": "topojson",
          "feature": "countries"
        }
      },
      "transform": [
        {"calculate": "datum.properties.id || datum.id", "as": "id"}, 
        {"lookup": "id", "from": {"data": {"name": "country_lookup"}, "key": "id", "fields": ["name"]}, "as": "country_name"}
      ],
      "projection": {"type": "equalEarth"},
      "mark": {"type": "geoshape", "stroke": "black"},
      "encoding": {
        "color": {
          "condition": [
             {"test": "datum.country_name === selected_country", "value": "#2563eb"}, // color of selected one
             {"test": "datum.country_name !== null", "value": "#93c5fd"} 
          ],
          "value": "#93c5fd" //  default color
        },
        "tooltip":
        [
          {"field": "country_name", "type": "nominal", "title": "Country Name"}
        ]
      },
      "config": {"view": {"stroke": null}}
    },
    // row 2
    {
      "hconcat": [
        // new cases chart
        {
          "title": "New Cases per Day",
          "width": 370,
          "height": 130, 
          "params": [
            
            {"name": "zoom_cases", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales"}
          ],
          "transform": [
            {"filter": "datum.country === selected_country"}, 
            {"filter": "datum.new_cases_smoothed != null"}
          ],
          "mark": {"type": "line", "color": "#dc2626", "strokeWidth": 2},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": null, "format": "%Y-%m"}},
            "y": {"field": "new_cases_smoothed", "type": "quantitative", "title": "Cases", "scale": {"zero": false}},
            "tooltip": [{"field": "date", "type": "temporal"}, {"field": "new_cases_smoothed", "type": "quantitative", "title": "Cases"}]
          }
        },
        // vaccine chart
        {
          "title": "Fully Vaccinated People per 100",
          "width": 370,
          "height": 130, 
          "params": [
            
            {"name": "zoom_vaccines", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales"}
          ],
          "transform": [
            {"filter": "datum.country === selected_country"}, 
            {"filter": "datum.people_fully_vaccinated_per_hundred != null"}
          ],
          "mark": {"type": "bar", "color": "#16a34a"},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": null, "format": "%Y-%m"}},
            "y": {"field": "people_fully_vaccinated_per_hundred", "type": "quantitative", "title": "% Vaccinated", "scale": {"zero": true, "domain": [0, 100]}},
            "tooltip": [{"field": "date", "type": "temporal"}, {"field": "people_fully_vaccinated_per_hundred", "type": "quantitative", "title": "% Vaccinated"}]
          }
        }
      ]
    },
    // 3rd row
    {
      "hconcat": [ 
        // deaths chart
        {
          "title": "New Deaths per Day",
          "width": 370,
          "height": 130, 
          "params": [
            
            {"name": "zoom_deaths", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales"}
          ],
          "transform": [
            {"filter": "datum.country === selected_country"}, 
            {"filter": "datum.new_deaths_smoothed != null"}
          ],
          "mark": {"type": "line", "color": "#7f1d1d", "strokeWidth": 2},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": null, "format": "%Y-%m"}},
            "y": {"field": "new_deaths_smoothed", "type": "quantitative", "title": "Deaths", "scale": {"zero": false}},
            "tooltip": [{"field": "date", "type": "temporal"}, {"field": "new_deaths_smoothed", "type": "quantitative", "title": "Deaths"}]
          }
        },
        // total test chart
        {
          "title": "Total Tests",
          "width": 370,
          "height": 130,
          "params": [
            
            {"name": "zoom_tests", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales"}
          ],
          "transform": [
            {"filter": "datum.country === selected_country"}, 
            {"filter": "datum.total_tests != null"}
          ],
          "mark": {"type": "bar", "color": "#2563eb"},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": null, "format": "%Y-%m"}},
            "y": {"field": "total_tests", "type": "quantitative", "title": "Total Tests", "scale": {"zero": true}},
            "tooltip": [{"field": "date", "type": "temporal"}, {"field": "total_tests", "type": "quantitative", "title": "Total Tests"}]
          }
        }
      ]
    },
    // last row
    {
      "hconcat": [
        // reproduction chart
        {
          "title": "Reproduction Rate (R)",
          "width": 750, 
          "height": 130, 
          "params": [
            
            {"name": "zoom_reproduction", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales"}
          ],
          "transform": [
            {"filter": "datum.country === selected_country"}, 
            {"filter": "datum.reproduction_rate != null"}
          ],
          "mark": {"type": "line", "color": "#7e22ce", "strokeWidth": 2},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "title": "Date", "axis":{"format": "%Y-%m-%d"}},
            "y": {"field": "reproduction_rate", "type": "quantitative", "title": "Reproduction Rate", "scale": {"zero": false}},
            "tooltip": [{"field": "date", "type": "temporal"}, {"field": "reproduction_rate", "type": "quantitative", "title": "Reproduction Rate"}]
          }
        }
      ]
    }
  ],
  "config": {
    "axis": {"grid": true, "labelFontSize": 10},
    "title": {"anchor": "start", "fontSize": 14, "fontWeight": "bold"}
  }
};

vegaEmbed("#vis", spec).catch(console.error);

</script>

</body>
</html>